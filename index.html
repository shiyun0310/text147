<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å­¸è¨“ç·´è¨ˆç•«ä¸»æŒäººå·¥ä½œåŠ ğŸš€</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­å®šè‡ªè¨‚å­—é«”å’Œä¸»èƒŒæ™¯æ¼¸å±¤ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* é…·ç‚«ç´«è‰²æ¼¸å±¤èƒŒæ™¯ */
            background-color: #4c1d95; /* Fallback color */
            background-image: linear-gradient(to right top, #4c1d95, #7c3aed, #a855f7, #c084fc, #e9d5ff);
            min-height: 100vh;
        }

        /* æ´»æ½‘çš„é™°å½±å’Œå‹•ç•«æ•ˆæœ */
        .card-glow {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 10px 25px -3px rgba(168, 85, 247, 0.5), 0 4px 6px -2px rgba(168, 85, 247, 0.2);
        }
        .card-glow:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -5px rgba(168, 85, 247, 0.7), 0 8px 10px -4px rgba(168, 85, 247, 0.4);
        }
        
        .btn-submit {
            transition: all 0.2s ease;
        }
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.6);
        }
        
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="w-full max-w-4xl bg-white bg-opacity-95 card-glow rounded-3xl p-6 md:p-10 my-8">

        <!-- æ¨™é¡Œå€å¡Š -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-800 tracking-tight mb-2">
                æ•™å­¸è¨“ç·´è¨ˆç•«ä¸»æŒäººå·¥ä½œåŠ âœ¨
            </h1>
            <p class="text-xl text-purple-600 font-semibold mt-3">
                æ¿€ç™¼æ•™å­¸æ½›èƒ½ï¼Œå…±å‰µå“è¶Šé†«ç™‚æ•™è‚²ï¼ğŸš€
            </p>
            <hr class="mt-4 border-2 border-pink-400 w-24 mx-auto rounded-full">
        </header>

        <!-- æ´»å‹•è³‡è¨Šå€å¡Š -->
        <section class="mb-10 p-6 bg-purple-50 rounded-2xl border-l-4 border-pink-500 shadow-lg">
            <h2 class="text-3xl font-bold text-purple-700 mb-4 flex items-center">
                æ´»å‹•è³‡è¨Š â„¹ï¸
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-gray-700 font-medium">
                <p class="flex items-center"><span class="text-2xl mr-2">ğŸ—“ï¸</span> **æ—¥æœŸï¼š** 2026/01/25</p>
                <p class="flex items-center"><span class="text-2xl mr-2">ğŸ•’</span> **æ™‚é–“ï¼š** 9:00 ~ 16:00</p>
                <p class="flex items-center"><span class="text-2xl mr-2">ğŸ“</span> **åœ°é»ï¼š** å¥‡ç¾é†«é™¢ç¬¬äº”é†«ç™‚å¤§æ¨“6æ¨“563æœƒè­°å®¤</p>
            </div>
        </section>
        
        <!-- é¡æ»¿è¨Šæ¯å€å¡Š (é è¨­éš±è—) -->
        <div id="full-message-container" class="hidden text-center p-8 md:p-12 bg-red-50 border-4 border-red-400 rounded-2xl shadow-xl">
            <p class="text-6xl mb-4">ğŸ›‘</p>
            <h2 class="text-3xl md:text-4xl font-extrabold text-red-800 mb-2">
                å ±åå·²é¡æ»¿ (4 äººä¸Šé™)
            </h2>
            <p class="text-xl text-red-600 font-medium">
                æ„Ÿè¬æ‚¨å°æœ¬æ¬¡å·¥ä½œåŠçš„ç†±çƒˆæ”¯æŒï¼Œåé¡å·²å…¨æ•¸é¡æ»¿ã€‚
            </p>
            <p class="text-base text-red-500 mt-2">
                è«‹é—œæ³¨ä¸‹æ¬¡æ´»å‹•è³‡è¨Šï¼Œé€ æˆä¸ä¾¿æ•¬è«‹è¦‹è«’ã€‚
            </p>
        </div>


        <!-- å ±åè¡¨å–®å€å¡Š (é è¨­é¡¯ç¤ºï¼Œè‹¥é¡æ»¿æœƒè¢«éš±è—) -->
        <section id="registration-section">
            <h2 class="text-3xl font-bold text-indigo-700 mb-6 flex items-center">
                å ±åç™»è¨˜ ğŸ“
            </h2>
            <form id="registration-form" class="space-y-6">

                <!-- åŸºç¤è³‡è¨Š -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">å§“å *</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                    </div>
                    <div>
                        <label for="institution" class="block text-sm font-medium text-gray-700">æ©Ÿæ§‹å *</label>
                        <input type="text" id="institution" name="institution" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700">è·ç¨± *</label>
                        <input type="text" id="title" name="title" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                    </div>
                    <div>
                        <label for="profession" class="block text-sm font-medium text-gray-700">è² è²¬çš„è·é¡ * (ä¸‹æ‹‰å¼é¸å–®)</label>
                        <select id="profession" name="profession" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150 bg-white">
                            <option value="" disabled selected>è«‹é¸æ“‡è·é¡</option>
                            <option value="è—¥äº‹">è—¥äº‹</option>
                            <option value="é†«äº‹æ”¾å°„">é†«äº‹æ”¾å°„</option>
                            <option value="é†«äº‹æª¢é©—">é†«äº‹æª¢é©—</option>
                            <option value="è­·ç†">è­·ç†</option>
                            <option value="ç‡Ÿé¤Š">ç‡Ÿé¤Š</option>
                            <option value="å‘¼å¸æ²»ç™‚">å‘¼å¸æ²»ç™‚</option>
                            <option value="è½åŠ›">è½åŠ›</option>
                            <option value="ç‰©ç†æ²»ç™‚">ç‰©ç†æ²»ç™‚</option>
                            <option value="è·èƒ½æ²»ç™‚">è·èƒ½æ²»ç™‚</option>
                            <option value="è‡¨åºŠå¿ƒç†">è‡¨åºŠå¿ƒç†</option>
                            <option value="èªè¨€æ²»ç™‚">èªè¨€æ²»ç™‚</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                
                <!-- æ“”ä»»è¨ˆç•«ä¸»æŒäººæƒ…æ³ (å–®é¸) -->
                <div class="bg-purple-100 p-4 rounded-xl">
                    <label class="block text-sm font-bold text-gray-800 mb-2">æ‚¨ç›®å‰æ˜¯å¦æ“”ä»»æ•™å­¸è¨“ç·´è¨ˆç•«ä¸»æŒäºº *</label>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex items-center">
                            <input id="is_director_yes" name="is_director" type="radio" value="æ˜¯" required class="focus:ring-pink-500 h-4 w-4 text-pink-600 border-gray-300">
                            <label for="is_director_yes" class="ml-2 block text-sm font-medium text-gray-700">æ˜¯</label>
                        </div>
                        <div class="flex items-center">
                            <input id="is_director_no" name="is_director" type="radio" value="å¦" class="focus:ring-pink-500 h-4 w-4 text-pink-600 border-gray-300">
                            <label for="is_director_no" class="ml-2 block text-sm font-medium text-gray-700">å¦</label>
                        </div>
                    </div>
                </div>

                <!-- åƒèˆ‡æ–¹å¼ (å–®é¸) -->
                <div class="bg-purple-100 p-4 rounded-xl">
                    <label class="block text-sm font-bold text-gray-800 mb-2">æ‚¨é è¨ˆä»¥ä½•ç¨®æ–¹å¼åƒèˆ‡ *</label>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex items-center">
                            <input id="mode_in_person" name="participation_mode" type="radio" value="å¯¦é«”" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <label for="mode_in_person" class="ml-2 block text-sm font-medium text-gray-700">å¯¦é«” ğŸ§‘â€ğŸ¤â€ğŸ§‘</label>
                        </div>
                        <div class="flex items-center">
                            <input id="mode_online" name="participation_mode" type="radio" value="ç·šä¸Š" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                            <label for="mode_online" class="ml-2 block text-sm font-medium text-gray-700">ç·šä¸Š ğŸ’»</label>
                        </div>
                    </div>
                </div>

                <!-- è¯çµ¡è³‡è¨Š -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email *</label>
                        <input type="email" id="email" name="email" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">è¯ç¹«é›»è©± *</label>
                        <input type="tel" id="phone" name="phone" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                    </div>
                </div>

                <!-- æäº¤æŒ‰éˆ• -->
                <div class="pt-4 text-center">
                    <button type="submit" class="btn-submit inline-flex justify-center items-center py-3 px-8 border border-transparent shadow-lg text-lg font-bold rounded-full text-white bg-pink-500 hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 uppercase tracking-wider transform hover:scale-105 transition duration-200">
                        ç«‹å³å ±åï¼âœ…
                    </button>
                </div>
                
                <!-- å ±åæˆåŠŸ/éŒ¯èª¤è¨Šæ¯å€å¡Š -->
                <div id="message-box" class="hidden mt-4 p-4 rounded-xl text-center font-semibold transition-all duration-300"></div>

            </form>
        </section>
        
        <!-- ä¸»è¾¦å–®ä½è³‡è¨Š -->
        <footer class="mt-10 pt-6 border-t border-purple-200 text-center text-sm text-gray-500">
            <h3 class="text-base font-semibold text-purple-600 mb-1">ä¸»è¾¦å–®ä½è³‡è¨Š ğŸ“</h3>
            <p>
                ä¸»è¾¦å–®ä½ï¼šå¥‡ç¾é†«é™¢æ•™å­¸éƒ¨
                <span class="mx-2 hidden sm:inline">|</span>
                <br class="sm:hidden">
                è¯çµ¡äººï¼šé™³å¤§é ­ (è«‹æ–¼ä¸Šç­æ™‚é–“æ’¥æ‰“)
                <span class="mx-2 hidden sm:inline">|</span>
                <br class="sm:hidden">
                è¯ç¹«é›»è©±ï¼š06-281-2811åˆ†æ©Ÿ57112233
            </p>
        </footer>

    </div>

    <script>
        // Apps Script ç¶²å€ (å·²æ›´æ–°ç‚ºæœ€æ–°ç¶²å€)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby13d_J5vGagI8fcOgkc7T9KqkhLg41StzPtS-bZmY6NMpk9-kx-knMK33TqC8jK5Zjpg/exec'; 
        const MAX_REGISTRATIONS = 4;
        
        const registrationSection = document.getElementById('registration-section');
        const fullMessageContainer = document.getElementById('full-message-container');
        const messageBox = document.getElementById('message-box');

        /**
         * æª¢æŸ¥ç›®å‰çš„å ±åäººæ•¸æ˜¯å¦å·²æ»¿ï¼Œä¸¦æ›´æ–°ç¶²é é¡¯ç¤ºã€‚
         */
        async function checkRegistrationStatus() {
            try {
                // ä½¿ç”¨ GET è«‹æ±‚ä¾†ç²å–æ•¸æ“š (doGet å‡½æ•¸)
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'GET',
                    cache: 'no-cache'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                // å¦‚æœ doGet å‚³å› status: 'full'ï¼Œè¡¨ç¤ºå·²é¡æ»¿
                if (result.status === 'full' || (result.total && result.total >= MAX_REGISTRATIONS)) {
                    registrationSection.classList.add('hidden');
                    fullMessageContainer.classList.remove('hidden');
                } else {
                    registrationSection.classList.remove('hidden');
                    fullMessageContainer.classList.add('hidden');
                }

            } catch (error) {
                console.error('æª¢æŸ¥å ±åç‹€æ…‹æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                // å³ä½¿æª¢æŸ¥å¤±æ•—ï¼Œä¹Ÿé è¨­é¡¯ç¤ºè¡¨å–®ï¼Œè®“ä½¿ç”¨è€…å˜—è©¦æäº¤
                registrationSection.classList.remove('hidden');
                fullMessageContainer.classList.add('hidden');
            }
        }
        
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ç‹€æ…‹
        window.onload = checkRegistrationStatus;
        
        // è¨­å®šæ¯ 10 ç§’è‡ªå‹•æ›´æ–°ç‹€æ…‹ï¼Œç¢ºä¿å³æ™‚æ€§
        setInterval(checkRegistrationStatus, 10000); 

        // è¡¨å–®æäº¤è™•ç†
        document.getElementById('registration-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            messageBox.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
            messageBox.classList.add('bg-purple-100', 'text-purple-700');
            messageBox.innerHTML = 'ğŸ”„ è³‡æ–™é€å‡ºä¸­... è«‹ç¨å€™ â³';

            try {
                // ç²å–è¡¨å–®æ•¸æ“š
                const formData = new FormData(form);
                const params = new URLSearchParams(formData);

                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: params.toString(), 
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    cache: 'no-cache'
                });

                // Apps Script å›å‚³ JSON æ ¼å¼
                const result = await response.json();

                if (result.status === 'success') {
                    // æˆåŠŸè¨Šæ¯
                    messageBox.classList.remove('bg-purple-100', 'text-purple-700');
                    messageBox.classList.add('bg-green-100', 'text-green-700');
                    messageBox.innerHTML = 'ğŸ‰ **å ±åæˆåŠŸï¼** æ‚¨çš„è³‡æ–™å·²åŒ¯å…¥ Google Sheetsï¼Œ**ç¢ºèªä¿¡ä»¶å·²å¯„è‡³æ‚¨çš„ä¿¡ç®±ï¼**';
                    form.reset(); // æ¸…ç©ºè¡¨å–®
                    
                    // æäº¤æˆåŠŸå¾Œï¼Œé‡æ–°æª¢æŸ¥ç‹€æ…‹ï¼Œå¯èƒ½æœƒç«‹å³é¡¯ç¤ºé¡æ»¿è¨Šæ¯
                    checkRegistrationStatus(); 
                } else if (result.message === 'FULL') {
                    // å ±åé¡æ»¿è¨Šæ¯ (å¾ Apps Script å‚³å›çš„ç‰¹å®šéŒ¯èª¤ç¢¼)
                    messageBox.classList.remove('bg-purple-100', 'text-purple-700', 'hidden');
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                    messageBox.innerHTML = `âŒ ${result.displayMessage || 'æŠ±æ­‰ï¼Œå ±åå·²é¡æ»¿ï¼'}`;
                    
                    // ç«‹å³æ›´æ–°é é¢é¡¯ç¤ºç‚ºé¡æ»¿
                    registrationSection.classList.add('hidden');
                    fullMessageContainer.classList.remove('hidden');
                } else {
                    // å…¶ä»–éŒ¯èª¤è¨Šæ¯
                    messageBox.classList.remove('bg-purple-100', 'text-purple-700');
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                    messageBox.innerHTML = `âŒ **å ±åå¤±æ•—ï¼** éŒ¯èª¤è¨Šæ¯ï¼š${result.message || 'è«‹æª¢æŸ¥ Apps Script éƒ¨ç½²èˆ‡è¨­å®šã€‚'}`;
                    console.error('Apps Script Error:', result.message);
                }

            } catch (error) {
                // ç¶²è·¯æˆ– Fetch ç¨‹å¼ç¢¼éŒ¯èª¤
                messageBox.classList.remove('bg-purple-100', 'text-purple-700');
                messageBox.classList.add('bg-red-100', 'text-red-700');
                messageBox.innerHTML = `ğŸš¨ **ç™¼ç”Ÿä¾‹å¤–éŒ¯èª¤ï¼** è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– Apps Script ç¶²å€æ˜¯å¦æ­£ç¢ºã€‚`;
                console.error('Submission Error:', error);
            }
            
            // 5 ç§’å¾Œè‡ªå‹•éš±è—è¨Šæ¯ (é™¤éå·²ç¶“é¡¯ç¤ºé¡æ»¿çš„ç´…è‰²å¤§å€å¡Š)
            if (fullMessageContainer.classList.contains('hidden')) {
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 5000);
            }
        });
    </script>
</body>
</html>
